### 发送方向
#### 三层转发时，当根据目的IP查询到的出接口为VLAN虚接口时，是如何找到最终的物理出接口的？
当三层交换机根据目的 IP 地址查询到的出接口为 VLAN 虚拟接口时，其寻找最终的物理出接口进行报文转发的过程主要基于 MAC 地址表（有时被称为 CAM 表）和 VLAN 信息。
以下是详细步骤：
  1.交换机首先会根据目的 IP 地址查找路由表（也称为 IP 路由表），确定下一跳 IP 地址。
  2.三层交换机使用 ARP 缓存或通过发送 ARP 请求来查找下一跳 IP 地址的 MAC 地址。ARP 是一种解析网络层（IP）地址到链路层（MAC）地址的协议。
  3.一旦交换机确定了目标 MAC 地址，它将查找 MAC 地址表来确定与该 MAC 地址关联的物理接口或端口。
  4.在这个过程中，交换机还将使用 VLAN 信息。如果 VLAN 虚拟接口与一个或多个物理接口关联，交换机将查找在相应 VLAN 中的 MAC 地址表。
  5.一旦交换机找到了与目标 MAC 地址对应的物理接口，它将将数据包转发到该接口。
这样，即使出接口为 VLAN 虚接口，三层交换机仍然能够根据 MAC 地址和 VLAN 信息正确地将数据包转发到最终的物理接口。这就是为什么在大型网络环境中，三层交换机和 VLAN 是如此重要：它们可以提供灵活的网络拓扑和高效的数据包转发机制。

#### MAC地址表是每VLAN一份吗？
是的，每个 VLAN 在交换机上都有自己的 MAC 地址表。这是因为每个 VLAN 都被视为一个独立的广播域，它们之间的通信需要通过路由器或者三层交换机来实现，所以需要有独立的 MAC 地址表来进行数据包的转发。

交换机会根据接收到的数据包的 VLAN 标签来决定使用哪个 MAC 地址表进行查找和转发。这种方式有助于减少不必要的数据包泛洪，提高网络的效率，同时也提供了一定的安全性，因为在同一台交换机上的不同 VLAN 之间的通信是默认被隔离的。

### 接收方向
#### 
